# –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –¥–∏–ø–ª–æ–º—É. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º —è–≤–ª—è–µ—Ç—Å—è NierDelta

#üåê IP Geolocation Database 

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ —Å –≥–µ–æ–¥–∞–Ω–Ω—ã–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ IP-–∞–¥—Ä–µ—Å–æ–≤ (–Ø–Ω–¥–µ–∫—Å –ê–ü–ò).

## üöÄ –ü—Ä–æ–≥—Ä–∞–º–º—ã

- **Liquibase** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **PostgreSQL** ‚Äî —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Java** ‚Äî –±—ç–∫–µ–Ω–¥ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- **pgAdmin** - –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã —Å –±–¥
## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ [Liquibase](https://www.liquibase.org/download)
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ (–í —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–µ —Å—Ä–∞–∑—É —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è pgADmin) [PosgreSql] (https://www.enterprisedb.com/downloads/postgres-postgresql-downloads)
   - –ü–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å—Ä–∞–∑—É –æ—Ç–∫–ª—é—á—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ —á–µ—Ä–µ–∑ PowerShell[Set-ExecutionPolicy RemoteSigned]
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î –≤ `liquibase.properties`:
     ```properties
     url=jdbc:postgresql://localhost:5432/geoip_db
     username=postgres
     password=123
     ```

2. **–ó–∞–ø—É—Å–∫ **:
 liquibase --changeLogFile=changelog.xml update
## üóÉÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `requests`
| –°—Ç–æ–ª–±–µ—Ü             | –¢–∏–ø         | –û–ø–∏—Å–∞–Ω–∏–µ                  |
|---------------------|-------------|---------------------------|
| `id`                | BIGINT      | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç) |
| `ip_address`        | VARCHAR(15) | IP-–∞–¥—Ä–µ—Å (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ) |
| `request_timestamp` | TIMESTAMP   | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞    |

### –¢–∞–±–ª–∏—Ü–∞ `responses`
| –°—Ç–æ–ª–±–µ—Ü               | –¢–∏–ø          | –û–ø–∏—Å–∞–Ω–∏–µ                  |
|-----------------------|--------------|---------------------------|
| `id`                  | BIGINT       | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç) |
| `request_id`          | BIGINT       | –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –∫ `requests.id` |
| `country_code`        | VARCHAR(2)   | –ö–æ–¥ —Å—Ç—Ä–∞–Ω—ã (RU,EU) |
| `country_name`        | VARCHAR(100) | –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã           |
| `city`                | VARCHAR(100) | –ì–æ—Ä–æ–¥                     |
| `latitude`            | DOUBLE       | –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —à–∏—Ä–æ—Ç–∞     |
| `longitude`           | DOUBLE       | –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –¥–æ–ª–≥–æ—Ç–∞    |
| `response_timestamp`  | TIMESTAMP    | –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞    |

## üõ†Ô∏è –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:
```
-- –ó–∞–ø—Ä–æ—Å
INSERT INTO requests (ip_address, request_timestamp)
VALUES ('192.168.1.1', NOW());

-- –û—Ç–≤–µ—Ç
INSERT INTO responses (request_id, country_code, city, response_timestamp)
VALUES (1, 'RU', 'Moscow', NOW());
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**:
```
SELECT 
  requests.ip_address,
  responses.country_name,
  responses.city,
  responses.response_timestamp
FROM requests
JOIN responses ON requests.id = responses.request_id;
```

üîÑ –ö–æ–º–∞–Ω–¥—ã Liquibase

1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:
   ```
   liquibase update
   ```

2. –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π changeSet:
   ```
   liquibase rollbackCount 1
   ```

3. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:
   ```
   liquibase generateDocs
   ```

4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ –ë–î:
   ```
    liquibase --changeLogFile=changelog.xml update
   ```
